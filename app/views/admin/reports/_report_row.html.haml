%ul.target
  = key.humanize
%ul.report_actions

  - if buttons.nil?
    - rep = @report_map[key]
    - title = key.humanize

    - if rep
      %li= link_to image_tag("icon_edit.png"), edit_admin_report_path(rep)
      %li= link_to image_tag("icon_regenerate.png"), generate_admin_report_path(key), :title => 'Regenerate report'
      %li.separator
      - if rep.formatted_csv?
        %li= link_to "Formatted", admin_report_path(rep, :formatted => true), :title => 'Formatted report', :class => "sml_btn"
      %li= link_to "Raw", admin_report_path(rep), :title => 'CSV (Comma Separated Value) report', :class => "sml_btn"
    - else # If report wasnt generated yet, allow user to regen it.
      = link_to title, generate_admin_report_path(key), :title => 'Generate report', :class => "drill_down grayed-out target"
      %li= link_to image_tag("icon_regenerate.png"), generate_admin_report_path(key), :title => 'Regenerate report', :class => "regenerate"
  - else
    - buttons.each do |button|
      - rep_key = "#{button}_#{key}"
      - rep = @report_map[rep_key]
      - title = button == 'budget' ? 'Budget' : 'Expenditure'
      - if rep
        %li.report_action.js_dropdown_menu
          - link_to '#', :title => rep.csv_updated_at.present? ? "(updated #{distance_of_time_in_words_to_now(rep.csv_updated_at)} ago)" : "Report is not generated", :class => 'js_dropdown_trigger dropdown' do
            = title
            = image_tag "icon_dropdown.png"

          %ul.menu_items.admin_reports{:style => 'display: none'}
            - if rep.formatted_csv?
              %li= link_to 'Formatted report', admin_report_path(rep, :formatted => true), :class => 'js_address'
            %li= link_to 'CSV (Comma Separated Value) report', admin_report_path(rep, :formatted => true), :class => 'js_address'
            %li= link_to 'Regenerate report', generate_admin_report_path(rep_key), :class => 'js_address'
            %li= link_to 'Edit', edit_admin_report_path(rep), :class => 'js_address'
      - else # If report wasnt generated yet, allow user to regen it.
        %li
          = link_to title, generate_admin_report_path(rep_key), :title => 'Generate report', :class => "drill_down grayed-out target"
          %li= link_to image_tag("icon_regenerate.png"), generate_admin_report_path(rep_key), :title => 'Regenerate report', :class => "regenerate"
