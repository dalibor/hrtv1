%tbody
  %tr
    %td.name.wrap-20{:rowspan => 100}
      //= link_to "edit", edit_response_project_path(@response, project), :class => 'edit_button inline left push-12'

      = link_to "#{h project.name}", edit_response_project_path(@response, project)

      - project_errors = get_project_errors(project)
      - if project_errors.present?
        = image_tag "warning_12.png", :title => project_errors, :class => 'tooltip'

  = render 'activities', :response => @response, :project => project, :activities => project.normal_activities.sorted

  = render 'other_costs', :response => @response, :project => project, :other_costs => project.other_costs

  %tr.filler2
    %td{:colspan => 1}

    %td.total Activity & Other Costs Subtotal
    %td.wrap-10= n2crs((project.subtotals(:spend) || 0), project.currency)
    %td.wrap-10= n2crs((project.subtotals(:budget) || 0), project.currency)
    %td
  %tr.filler2
    %td{:colspan => 1}
      %ul.horizontal
        %li
    %td.total Project Total
    -if @response.project_and_activities_matching_amounts?(project, :spend)
      %td.wrap-10= n2crs((project.spend || 0), project.currency)
    -else
      %td.wrap-10.red= n2cndrs((project.spend || 0), project.currency)
    -if @response.project_and_activities_matching_amounts?(project, :budget)
      %td.wrap-10= n2crs((project.budget || 0), project.currency)
    -else
      %td.wrap-10.red= n2crs((project.budget || 0), project.currency)
    %td
  -if (!@response.project_and_activities_matching_amounts?(project, :spend) || !@response.project_and_activities_matching_amounts?(project, :budget))    
    %tr.filler_warning
      %td{:colspan => 1}

      %td.total Differences between Project Total and Activities + Other Costs Subtotal:
      %td.wrap-10= n2crs((project.spend || 0) - project.subtotals(:spend), project.currency)
      %td.wrap-10= n2crs((project.budget || 0) - project.subtotals(:budget), project.currency)
      %td= image_tag "warning_12.png", :title => get_project_total_differences(project), :class => 'tooltip_projects'
