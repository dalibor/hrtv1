- spend_amount = project.spend || 0
- budget_amount = project.budget || 0
- funders_total_spend = project.converted_funders_total_by_type('spend', false)
- remaining_spend = spend_amount - funders_total_spend
- funders_total_budget = project.converted_funders_total_by_type('budget', false)
- remaining_budget = budget_amount - funders_total_budget

%tr.js_project_row
  %td.name{:rowspan => project.in_flows.length + 2}= project.name

- project.in_flows.ordered_by_id.each do |funder|
  = render 'funder_row', :funder => funder, :type => params[:id]

%tr.filler2.js_project_total_row{:"data-project_id" => project.id}
  %td
    - link_to new_response_funder_path(@response), :class => 'add_funder add_row' do
      = image_tag "new.png"
      Add funder
  %td.total Subtotal
  %td.total
    %ul
      %li
        %span.js_project_total_spend_amount{:"data-rate" => currency_rate(project.currency, @response.currency)}= funders_total_spend
        %span.currency= project.currency
      %li.remaining.js_remaining_box{:style => (remaining_spend == 0 ? 'display: none' : nil)}
        Remaining
        %span.js_remaining= remaining_spend
        %span.currency= project.currency
  %td.total
    %ul
      %li
        %span.js_project_total_budget_amount{:"data-rate" => currency_rate(project.currency, @response.currency)}= funders_total_budget
        %span.currency= project.currency
      %li.remaining.js_remaining_box{:style => (remaining_budget == 0 ? 'display: none' : nil)}
        Remaining
        %span.js_remaining= remaining_budget
        %span.currency= project.currency
